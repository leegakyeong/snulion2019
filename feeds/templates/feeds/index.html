{% extends "base.html" %}

{% block content %}
    <h1>feed page</h1>
    <a href="/feeds/new">new feed</a>
    {% for feed in feeds %}
        <div style="border: 1px solid grey;">
            <a href="/feeds/{{ feed.id }}">더보기</a>
            <form action="/feeds/{{ feed.id }}/delete" method='POST'>
                {% csrf_token %}
                <button type="submit">삭제</button>
            </form>
            <p>{{ feed.title }}</p>
                <p>작성자:
                    <strong>{{feed.author.username}}</strong>
                    (following: {{ feed.author.follow_to.all.count }} / follower: {{ feed.author.follow_from.all.count }})

                        {% if request.user != feed.author %}
                        <a href="feeds/{{ feed.author.id }}/follow">
                            {% if request.user not in feed.author.follows.all %}
                                팔로우
                            {% else %}
                                팔로우 취소
                            {% endif %}
                        </a>
                        {% endif %}
                </p>
            <p>{{ feed.content }}</p>
            <h3>댓글</h3>
                {% for c in feed.feedcomment_set.all %}
                    <p>{{c.author.username}}: {{ c.content }}</p>
                    <form action="/feeds/{{ feed.id }}/comments/{{ c.id }}/" method="POST">
                        {% csrf_token %}
                        <button>댓글 삭제</button>
                    </form>
                {% endfor %}
                <form action="/feeds/{{ feed.id }}/comments/" method="POST">
                    {% csrf_token %}
                    <input type="text" name="content" />
                    <button type="submit">댓글 달기</button>
                </form>
                <a href="/feeds/{{ feed.id }}/like">{{ feed.like_user_set.count }} Likes</a>
        </div>
    {% endfor %}
{% endblock content %}